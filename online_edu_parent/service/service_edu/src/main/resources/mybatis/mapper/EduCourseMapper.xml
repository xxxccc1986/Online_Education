<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.year21.onlineedu.serviceedu.mapper.EduCourseMapper">
    <resultMap id="vopublish" type="top.year21.onlineedu.serviceedu.vo.VOPublish">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="lessonNum" column="lesson_num"/>
        <result property="oneSubject" column="oneSubject"/>
        <result property="twoSubject" column="twoSubject"/>
        <result property="teacherName" column="name"/>
        <result property="lessonNum" column="lessonNum"/>
        <result property="cover" column="cover"/>
        <result property="price" column="price"/>
    </resultMap>

<!--    根据课程id查询相关信息 VOPublish getVOPublishById(@Param("id")String id);-->
    <select id="getVOPublishById" resultMap="vopublish">
        SELECT c.`id`,c.`title`,c.`lesson_num`,c.`cover`,c.`price`,
            t.`name`,temp2.title AS oneSubject,s.`title` AS twoSubject
        FROM edu_course c
        LEFT JOIN edu_teacher t
        ON c.`teacher_id` = t.`id`
        LEFT JOIN edu_subject s
        ON c.`subject_id` = s.`id`
        LEFT JOIN (
               SELECT * FROM (
                      SELECT
                      id,title
                      FROM edu_subject
                      )AS temp
               )AS temp2
        ON c.`subject_parent_id` = temp2.id
        WHERE c.`id` = #{id};
    </select>

<!--    int updateStatus(String courseId);-->
    <update id="updateStatus">
        update edu_course set status = 'Normal' where id = #{courseId}
    </update>

    <!--  自定义映射规则  -->
    <resultMap id="queryVOFrontCourseDetails" type="top.year21.onlineedu.serviceedu.vo.VOFrontCourseDetails">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="cover" property="cover"/>
        <result column="price" property="price"/>
        <result column="teacher_id" property="teacherId"/>
        <result column="buy_count" property="buyCount"/>
        <result column="lesson_num" property="lessonNum"/>
        <result column="view_count" property="viewCount"/>
        <result column="name" property="name"/>
        <result column="career" property="career"/>
        <result column="avatar" property="avatar"/>
        <result column="description" property="description"/>
    </resultMap>

    <!--    VOFrontCourseDetails queryCourseDetails(@Param("courseId") String courseId);-->
    <select id="queryCourseDetails" resultMap="queryVOFrontCourseDetails">
        SELECT  c.`id`,c.title,c.`cover`,c.`price`,c.`teacher_id`,c.`buy_count`,
                c.`lesson_num`,c.`view_count`,t.`name`,t.`career`,
                t.`avatar`,d.`description`
        FROM edu_course c
        LEFT JOIN edu_teacher t
        ON c.`teacher_id` = t.`id`
        LEFT JOIN edu_course_description d
        ON c.`id` = d.`id`
        WHERE c.id = #{courseId};
    </select>
</mapper>
